<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="help">

<!--1.공지사항 목록보기  -->
<select  id="helpList"  parameterType="map"  resultType="Help"  >
    select help_number, help_title, help_content, TO_CHAR(help_regdate, 'YYYY-MM-DD') AS help_regdate, help_hit, admin_id
            from ( select a.*, rownum rnum
                from (select * from help
                   <where>
                     <if test="keyWord!=null and keyField=='title'">
                            help_title like '%' || #{keyWord} || '%'
                     </if>
                     <if test="keyWord!=null and keyField=='content'">
                            help_content like '%' || #{keyWord} || '%'
                     </if>
                     <if test="keyWord!=null and keyField=='all'">
                            help_title like '%' || #{keyWord} || '%'  or
                            help_content like '%' || #{keyWord} || '%'
                     </if>
                   </where>        
                     order by help_number desc)a)
  <![CDATA[
    where rnum >=#{start} AND rnum <=#{end}
    ]]>
</select>

<!--2.검색어에 해당하는 총레코드수 구하기 -->
 <select id="selectAll" parameterType="map" resultType="Integer">
    select count(*) from help
                <where>
                     <if test="keyWord!=null and keyField=='title'">
                            help_title like '%' || #{keyWord} || '%'
                     </if>
                     <if test="keyWord!=null and keyField=='content'">
                            help_content like '%' || #{keyWord} || '%'
                     </if>
                     <if test="keyWord!=null and keyField=='all'">
                            help_title like '%' || #{keyWord} || '%'  or
                            help_content like '%' || #{keyWord} || '%'
                     </if>
                 </where>
 </select>
 
<!-- 3.공지사항 쓰기(게시물 번호 최대값구하기) -->
<select id="getNewNumMax" resultType="int">
   select max(help_number) from help
</select>

<!-- 4.공지사항 쓰기 -->
<insert id="helpWrite" parameterType="Help">
    insert into help(help_number, help_title, help_content, help_regdate, help_hit, admin_id)
    values(#{help_number},#{help_title},#{help_content}, sysdate, 0, #{admin_id})
</insert>

<!-- 5.공지사항 상세보기(조회수증가)  -->
<update id="updateReadcntUp" parameterType="int">
   update help set help_hit=help_hit+1 where help_number=#{help_number}
</update>

<!-- 6.공지사항 번호에 해당하는 레코드 한개 얻어오기 -->
<select id="retrieveGet" parameterType="int" resultType="Help">
    select * from help where help_number=#{help_number}
</select>
 
<!-- 7.공지사항 수정하기 -->
<update id="helpUpdate" parameterType="Help">
 	update help set help_title=#{help_title}, help_content=#{help_content} where help_number=#{help_number}
</update>
 
<!-- 8.공지사항 삭제하기 -->
<delete id='helpDelete' parameterType="int">
	delete from help where help_number=#{help_number}
</delete>
 
</mapper>
